!function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){var e,n,r=this;if("function"!=typeof r)throw new TypeError;return e=Array.prototype.slice.call(arguments,1),n=function(){if(this instanceof n){var i,a,s;return i=function(){},i.prototype=r.prototype,a=new i,s=r.apply(a,e.concat(Array.prototype.slice.call(arguments))),Object(s)===s?s:a}return r.apply(t,e.concat(Array.prototype.slice.call(arguments)))}})}(),function(){Debug.fatalError=function(t){var e=t.message+"\non "+t.file+" (code: "+t.code+")\n";if(t.stackTrace)for(var n=0;n<t.stackTrace.length;n++)e+="\n	 #"+(n+1)+". "+t.stackTrace[n];Debug.error(e)}}(),function(t,e){"use strict";function n(t){return null===t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}var r=function(){},i=r.prototype;i._listeners=[],i.trigger=function(t,n){if(this._listeners[t]!==e)for(var r=this._listeners[t],i=0;i<r.length;i++)r[i](n)},i.on=function(t,e){if("object"===n(t))for(var r in t)t.hasOwnProperty(r)&&this.on(r,t[r]);else if("function"===n(e))for(var i=t.split(" "),a=null,s=0,o=i.length;o>s;s++)a=i[s],this._listeners[a]=this._listeners[a]||[],-1===this._callbackIndex(a,e)&&this._listeners[a].push(e);else if("array"===n(e))for(var u=0,l=e.length;l>u;u++)this.on(t,e[u]);return this},i.off=function(t,r){if(t===e)this._listeners=[];else if("array"===n(r))for(var i=0,a=r.length;a>i;i++)this.off(t,r[i]);else for(var s=t.split(" "),o=null,u=0,l=s.length;l>u;u++)if(o=s[u],this._listeners[o]=this._listeners[o]||[],r===e)this._listeners[o].length=0;else{var c=this._callbackIndex(o,r);-1!==c&&this._listeners[t].splice(c,1)}return this},i._callbackIndex=function(t,e){for(var n=0,r=this._listeners[t].length;r>n;n++)if(this._listeners[t][n]===e)return n;return-1},namespace("Canteen").EventDispatcher=r}(window),$.fn.touch=function(t){return this.on("click",!1).on("touchclick",t)},$.fn.untouch=function(){return this.off("touchclick")},$.fn.internalLink=function(t){var e=Canteen.settings.basePath,n=Canteen.settings.siteIndex,r=t.currentState,i=function(t){if(t.hasClass("confirm")){var e=t.data("confirm")||"Are you sure you wish to continue?",n=confirm(e);return n}return!0};return this.each(function(){var a,s=$(this),o=s.data("refresh"),u=s.attr("href");if("undefined"!=typeof o)return void s.untouch().touch(function(e){return i(s)?"soft"==o?(e.preventDefault(),void t.refresh()):void(u?document.location.href=u:t.refresh(!1)):void 0});if(u&&0===u.indexOf(e)){a=u.substr(e.length),s.untouch().touch(function(e){e.preventDefault(),i(s)&&t.redirect(a)}).removeClass("selected");var l=new RegExp("^"+a.replace("/","/")+"(/.*)?$");(a==r||""!==r&&l.test(r)||a==n&&""===r)&&s.addClass("selected")}})},function(){"use strict";var t=function(){},e=864e5;t.NEVER_EXPIRE="neverExpire",t.clear=function(e){t.write(e,"",-1)},t.write=function(n,r,i){var a,s;i?(i==t.NEVER_EXPIRE?s=new Date(2147483646e3):(s=new Date,s.setTime(s.getTime()+i*e)),a="; expires="+s.toGMTString()):a="",document.cookie=n+"="+r+a+"; path=/"},t.read=function(t){var e,n=t+"=",r=document.cookie.split(";"),i=0;for(i=0;i<r.length;i++){for(e=r[i];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(n))return e.substring(n.length,e.length)}return null},namespace("Canteen").SavedData=t}(),function(){"use strict";var t=function(){throw"Location Utils is a static class"};t.getParameters=function(){var t={},e=window.location.href,n=e.indexOf("?"),r=null,i=null,a=null,s=null,o=null;if(-1==n)return t;r=0>n?"":e.substr(n+1),i=r.indexOf("#"),r=0>i?r:r.substring(0,i),a=r.split("&");for(o in a)s=a[o].split("="),t[s[0]]=s[1];return t},namespace("Canteen").LocationUtils=t}(),function(t){"use strict";var e=function(){};e.ERROR="error",e.DISABLED="disabled",e.SELECTED="selected",e.REQUIRED="required",e.CONFIRM="confirm",e.FEEDBACK_ERROR="formError",e.FEEDBACK_SUCCESS="formSuccess",e.destroy=function(){$("input."+e.CONFIRM+", button."+e.CONFIRM).untouch(),$("form").resetForm().off("submit"),$(":submit").untouch()},e.setup=function(n,r){for(var i=new Array("text","button","reset","submit","checkbox","image","radio","file","password","date"),a=function(t){var e=$(t.target).closest("form"),n=e.find(":submit").eq(0);13==t.keyCode&&n&&(t.stopImmediatePropagation(),t.preventDefault(),n.trigger("touchclick"))},s=0,o=i.length;o>s;s++)$("input[type='"+i[s]+"']").removeClass(i[s]).addClass(i[s]).keyup(a);$("input."+e.CONFIRM+", button."+e.CONFIRM).untouch().touch(function(t){var n=$(this).data(e.CONFIRM)||"Are you sure you wish to continue?",r=confirm(n);return r?void 0:(t.stopImmediatePropagation(),!1)}),$('input[name="formSession"]').remove();var u=function(t,r){var i=r.find("."+e.REQUIRED).removeClass(e.ERROR),a=i.filter(function(){return!this.value}).addClass(e.ERROR);if(a.length>0){var s=function(){$(this).removeClass(e.ERROR).off("keydown")};return a.untouch().on("touchclick focus keydown",s),!1}for(var o={},u=0,l=t.length;l>u;u++)o[t[u].name]=t[u].value;return o.form?!0:(n.refresh(!0,o),!1)},l=function(r,i,a,s){if(-1==r.search(/^{.*}$/))return void Debug.error(r);if(r=JSON.parse(r),"fatalError"==r.type)return void Debug.fatalError(r);var o=s.find('input[name="refresh"]'),u=o.data("async");return r.redirect!==t?void n.redirect(r.redirect,!1,!0,u):!r.ifError&&o.length&&"true"==o.val()?void n.refresh(u):void e.formFeedback(s,r.messages,r.ifError)},c={data:{async:!0},beforeSubmit:u,success:l};$(":submit").touch(function(t){this.name&&this.value&&(c.data={async:!0},c.data[this.name]=this.value);var e=$(this).closest("form");e.length>0&&(t.preventDefault(),e.ajaxSubmit(c))}),$("form").on("submit",function(t){t.preventDefault(),$(this).ajaxSubmit(c)})},e.formFeedback=function(t,n,r){$("ul."+e.FEEDBACK_ERROR+", ul."+e.FEEDBACK_SUCCESS).remove();for(var i=r?e.FEEDBACK_ERROR:e.FEEDBACK_SUCCESS,a='<ul class="'+i+'">',s=0,o=n.length;o>s;s++)a+="<li>"+n[s]+"</li>";a+="</ul>";var u=t.find("legend");u.length?u.after(a):t.prepend(a)},namespace("Canteen").Forms=e}(),function(t){"use strict";var e=function(t,e){this.initialize(t,e)},n=e.prototype;n.gatewayUrl=null,n.initialize=function(t,e){this.gatewayUrl=t,"/"!=t.charAt(t.length-1)&&(this.gatewayUrl+="/"),this.get(function(t){var n=null===t||"error"==t.type;if(n)throw"Couldn't connect to gateway";e(!n)},"time","get-server-time")},n.get=function(e,n,r,i){var a=this.gatewayUrl+n+"/"+r;i!==t&&(a+="/"+($.isArray(i)?i.join("/"):String(i))),$.get(a,function(t){if(!t||"null"==t)return void e(null);if(-1==t.search(/^{.*}$/))return Debug.error(t),void e(null);var n=JSON.parse(t);return"fatalError"==n.type?(Debug.fatalError(n),void e(null)):void e(n)})},n.destroy=function(){n=null},namespace("Canteen").Gateway=e}(),function(){"use strict";var t=function(){},e=t.prototype;e.site=null,e.active=!1,e.uri=null,e.enter=function(){},e.exit=function(){},e.refresh=function(){return!0},e.resize=function(){},namespace("Canteen").Page=t}(),function(t,e,n){"use strict";var r=Canteen.EventDispatcher,i=Canteen.LocationUtils,a=Canteen.Gateway,s=Canteen.Forms,o=Canteen.Page,u=function(){this.initialize()},l=u.prototype=new r,c=null,f=null,h=null,d=null,g=[],p=null,v={contentId:"#content",pageTitleId:"h1",pageLoadingId:"article",siteLoadingId:"body",loadingClass:"loading"};l.currentState=null,l.currentPage=null,l.gateway=null,l.parameters=null,l.options={},u.ENTER="enter",u.EXIT="exit",u.READY="ready",u.LOADING="loading",u.LOADING_DONE="loadingDone",u.VERSION="1.1.5",u.instance=null,l.initialize=function(){if(c)throw"Site has already been created. Use Canteen.Site.instance";u.instance=c=this;var t=this.options=v;(Canteen.settings.clientEnabled===n||Canteen.settings.clientEnabled)&&(e(t.siteLoadingId).addClass(t.loadingClass),this.parameters=i.getParameters(),Debug.enabled=Canteen.settings.debug,h=1,this.currentState=d=Canteen.settings.uriRequest,this._enableHistory(!0),this._fixInternalLinks(),this.gateway=new a(Canteen.settings.gatewayPath,this._gatewayReady.bind(this)))},l._enableHistory=function(n){e(t).off("statechange"),n&&e(t).on("statechange",this._onStateChange.bind(this))},l.redirect=function(t,r,i,a){var s=Canteen.settings.basePath,o=e("<div />").html(e("title").html()).text();return r=r===n?!1:r,i=i===n?!1:i,a=a===n?!0:a,Canteen.settings.siteIndex!=t&&(s+=t),d==t?void(i&&this.refresh(a)):void(r?History.replaceState({state:h},o,s):(h++,History.pushState({state:h},o,s)))},l.refresh=function(t,e){t=t===n?!0:t,t?this._updatePageContent(d,e):document.location.reload(!0)},l._fixInternalLinks=function(){e("a").internalLink(this),s.setup(this,"true"===this.parameters.debugForms)},l._onStateChange=function(){var t=History.getState(),e=t.url.split(Canteen.settings.baseUrl)[1];d!=e&&this._updatePageContent(e)},l._gatewayReady=function(t){t||Debug.error("Unable to setup gateway.");var n=this.options;e(n.siteLoadingId).removeClass(n.loadingClass),e(window).on("resize",this.resize.bind(this)),this.resize(),this.trigger(u.READY),this._enterPage()},l.resize=function(){p&&p.active&&p.resize()},l.addPage=function(t,e){e instanceof o?(e.site=this,g.push({uri:t,content:e})):Debug.warn("The page your trying to add needs to extend Canteen.Page")},l._enterPage=function(){var t=this.getPageByUri(d);t&&(this.currentPage=p=t.content,p.uri=d,p.active=!0,p.enter(),this.resize()),this.trigger(u.ENTER,d)},l.getPageByUri=function(t){var e=g.length,n=0,r=null;if(0===e)return null;for(n=0;e>n;n++)if(r=g[n],r.uri===t||r.uri instanceof RegExp&&r.uri.test(t))return r;return null},l._updatePageContent=function(t,r){var i=this,a=this.options,o=this.getPageByUri(t),l=Canteen.settings.baseUrl+t;return this.trigger(u.EXIT,d),this.currentState=d=t,o&&o.content===p&&!o.content.refresh(t)?void(o.content.uri=t):(p&&(p.exit(),p.active=!1,this.currentPage=p=null),s.destroy(),f=t,r=r===n?{}:r,r.async=!0,this.trigger(u.LOADING),e(a.pageLoadingId).removeClass(a.loadingClass).addClass(a.loadingClass),void e.post(l,r,function(r){if(t==f){if(f=null,i.trigger(u.LOADING_DONE),e(a.pageLoadingId).removeClass(a.loadingClass),!r||"null"==r)return void Debug.error("No data for "+t);if(-1==r.search(/^{.*}$/))return void Debug.error(r);var s=JSON.parse(r);if("fatalError"==s.type)return void Debug.fatalError(s);if(s.redirect!==n)return void i.redirect(s.redirect,!0);e("body").attr("id",s.pageId),e(a.pageTitleId).html(s.title),e(a.contentId).html(s.content),document.title=e("<div />").html(s.fullTitle).text(),e("meta[name='keywords']").attr("content",s.keywords),e("meta[name='description']").attr("content",s.description),i._fixInternalLinks(),i._enterPage()}}))},namespace("Canteen").Site=u,e(function(){new u})}(window,jQuery);