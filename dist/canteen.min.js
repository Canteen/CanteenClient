/*! CanteenClient 1.2.0 */
!function(){Debug.fatalError=function(a){var b=a.message+"\non "+a.file+" (code: "+a.code+")\n";if(a.stackTrace)for(var c=0;c<a.stackTrace.length;c++)b+="\n	 #"+(c+1)+". "+a.stackTrace[c];Debug.error(b)}}(),function(a,b){"use strict";function c(a){return null===a?String(a):"object"==typeof a||"function"==typeof a?Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof a}var d=function(){},e=d.prototype;e._listeners=[],e.trigger=function(a,c){if(this._listeners[a]!==b)for(var d=this._listeners[a],e=0;e<d.length;e++)d[e](c)},e.on=function(a,b){if("object"===c(a))for(var d in a)a.hasOwnProperty(d)&&this.on(d,a[d]);else if("function"===c(b))for(var e=a.split(" "),f=null,g=0,h=e.length;h>g;g++)f=e[g],this._listeners[f]=this._listeners[f]||[],-1===this._callbackIndex(f,b)&&this._listeners[f].push(b);else if("array"===c(b))for(var i=0,j=b.length;j>i;i++)this.on(a,b[i]);return this},e.off=function(a,d){if(a===b)this._listeners=[];else if("array"===c(d))for(var e=0,f=d.length;f>e;e++)this.off(a,d[e]);else for(var g=a.split(" "),h=null,i=0,j=g.length;j>i;i++)if(h=g[i],this._listeners[h]=this._listeners[h]||[],d===b)this._listeners[h].length=0;else{var k=this._callbackIndex(h,d);-1!==k&&this._listeners[a].splice(k,1)}return this},e._callbackIndex=function(a,b){for(var c=0,d=this._listeners[a].length;d>c;c++)if(this._listeners[a][c]===b)return c;return-1},namespace("Canteen").EventDispatcher=d}(window),$.fn.touch=function(a){return this.on("click",!1).on("touchclick",a)},$.fn.untouch=function(){return this.off("touchclick")},$.fn.confirmation=function(a){var b="Are you sure you wish to continue?";return this.each(function(){var c=$(this),d=a||c.data("confirm")||b;c.touch(function(a){confirm(d)||a.stopImmediatePropagation()})})},$.fn.internalLink=function(a){var b=Canteen.settings.basePath,c=Canteen.settings.siteIndex,d=a.currentState;return this.each(function(){var e=$(this),f=e.data("selected")||"selected",g=e.attr("href"),h=g.substr(b.length);if(g&&0===g.indexOf(b)&&!/^([a-z]{3,}\:)/i.test(g)){e.removeClass(f).touch(function(b){b.preventDefault(),a.redirect(h,!1,!0)});var i=new RegExp("^"+h.replace("/","/")+"(/.*)?$");(h===d||""!==d&&i.test(d)||h==c&&""===d)&&e.addClass(f)}})},function(){"use strict";var a=function(){},b=864e5;a.NEVER_EXPIRE="neverExpire",a.clear=function(b){a.write(b,"",-1)},a.write=function(c,d,e){var f,g;e?(e==a.NEVER_EXPIRE?g=new Date(2147483646e3):(g=new Date,g.setTime(g.getTime()+e*b)),f="; expires="+g.toGMTString()):f="",document.cookie=c+"="+d+f+"; path=/"},a.read=function(a){var b,c=a+"=",d=document.cookie.split(";"),e=0;for(e=0;e<d.length;e++){for(b=d[e];" "==b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(c))return b.substring(c.length,b.length)}return null},namespace("Canteen").SavedData=a}(),function(){"use strict";var a=function(){throw"Location Utils is a static class"};a.getParameters=function(){var a={},b=window.location.href,c=b.indexOf("?"),d=null,e=null,f=null,g=null,h=null;if(-1==c)return a;d=0>c?"":b.substr(c+1),e=d.indexOf("#"),d=0>e?d:d.substring(0,e),f=d.split("&");for(h in f)g=f[h].split("="),a[g[0]]=g[1];return a},namespace("Canteen").LocationUtils=a}(),function(a){"use strict";var b=function(){};b.ERROR="error",b.DISABLED="disabled",b.SELECTED="selected",b.REQUIRED="required",b.CONFIRM="confirm",b.destroy=function(){$("input."+b.CONFIRM+", button."+b.CONFIRM).untouch(),$("form").resetForm().off("submit"),$(":submit").untouch()},b.setup=function(c,d){for(var e=new Array("text","button","reset","submit","checkbox","image","radio","file","password","date"),f=function(a){var b=$(a.target).closest("form"),c=b.find(":submit").eq(0);13==a.keyCode&&c&&(a.stopImmediatePropagation(),a.preventDefault(),c.trigger("touchclick"))},g=0,h=e.length;h>g;g++)$("input[type='"+e[g]+"']").removeClass(e[g]).addClass(e[g]).keyup(f);$("input."+b.CONFIRM+", button."+b.CONFIRM).untouch().touch(function(a){var c=$(this).data(b.CONFIRM)||"Are you sure you wish to continue?",d=confirm(c);return d?void 0:(a.stopImmediatePropagation(),!1)}),$('input[name="formSession"]').remove();var i=function(a,d){var e=d.find("."+b.REQUIRED).removeClass(b.ERROR),f=e.filter(function(){return!this.value}).addClass(b.ERROR);if(f.length>0){var g=function(){$(this).removeClass(b.ERROR).off("keydown")};return f.untouch().on("touchclick focus keydown",g),!1}for(var h={},i=0,j=a.length;j>i;i++)h[a[i].name]=a[i].value;return h.form?!0:(c.refresh(!0,h),!1)},j=function(d,e,f,g){if(-1==d.search(/^{.*}$/))return void Debug.error(d);if(d=JSON.parse(d),"fatalError"==d.type)return void Debug.fatalError(d);var h=g.find('input[name="refresh"]'),i=h.data("async");return d.redirect!==a?void c.redirect(d.redirect,!1,!0,i):!d.ifError&&h.length&&"true"==h.val()?void c.refresh(i):void b.formFeedback(g,d.messages)},k={data:{async:!0},beforeSubmit:i,success:j};$(":submit").touch(function(a){this.name&&this.value&&(k.data={async:!0},k.data[this.name]=this.value);var b=$(this).closest("form");b.length>0&&(a.preventDefault(),b.ajaxSubmit(k))}),$("form").on("submit",function(a){a.preventDefault(),$(this).ajaxSubmit(k)})},b.formFeedback=function(a,b){$(".formFeedback").remove();var c=a.find("legend");c.length?c.after(b):a.prepend(ul)},namespace("Canteen").Forms=b}(),function(a){"use strict";var b=function(a,b){this.initialize(a,b)},c=b.prototype;c.gatewayUrl=null,c.initialize=function(a,b){this.gatewayUrl=a,"/"!=a.charAt(a.length-1)&&(this.gatewayUrl+="/"),this.get(function(a){var c=null===a||"error"==a.type;if(c)throw"Couldn't connect to gateway";b(!c)},"time","get-server-time")},c.get=function(b,c,d,e){var f=this.gatewayUrl+c+"/"+d;e!==a&&(f+="/"+($.isArray(e)?e.join("/"):String(e))),$.get(f,function(a){if(!a||"null"==a)return void b(null);if(-1==a.search(/^{.*}$/))return Debug.error(a),void b(null);var c=JSON.parse(a);return"fatalError"==c.type?(Debug.fatalError(c),void b(null)):void b(c)})},c.destroy=function(){c=null},namespace("Canteen").Gateway=b}(),function(){"use strict";var a=function(){},b=a.prototype;b.site=null,b.active=!1,b.uri=null,b.enter=function(){},b.exit=function(){},b.refresh=function(){return!0},b.resize=function(){},namespace("Canteen").Page=a}(),function(a,b,c){"use strict";var d=Canteen.EventDispatcher,e=Canteen.LocationUtils,f=Canteen.Gateway,g=Canteen.Forms,h=Canteen.Page,i=function(){this.initialize()},j=i.prototype=new d,k=null,l=null,m=null,n=null,o=!0,p=[],q=null,r={contentId:"#content",pageTitleId:"h1",pageLoadingId:"article",siteLoadingId:"body",loadingClass:"loading"};j.currentState=null,j.currentPage=null,j.gateway=null,j.parameters=null,j.options={},i.ENTER="enter",i.EXIT="exit",i.READY="ready",i.LOADING="loading",i.LOADING_DONE="loadingDone",i.version="1.2.0",i.instance=null,j.initialize=function(){if(k)throw"Site has already been created. Use Canteen.Site.instance";i.instance=k=this;var d=this.options=r;(Canteen.settings.clientEnabled===c||Canteen.settings.clientEnabled)&&(b(d.siteLoadingId).addClass(d.loadingClass),this.parameters=e.getParameters(),Debug.enabled=Canteen.settings.debug,m=1,this.currentState=n=Canteen.settings.uriRequest,this._enableHistory(!(!a.history||!history.pushState)),o&&this._fixInternalLinks(),this.gateway=new f(Canteen.settings.gatewayPath,this._gatewayReady.bind(this)))},j._enableHistory=function(c){o=c,b(a).off("statechange"),c&&b(a).on("statechange",this._onStateChange.bind(this))},j.redirect=function(a,d,e,f){var g=Canteen.settings.basePath,h=b("<div />").html(b("title").html()).text();return d=d===c?!1:d,e=e===c?!1:e,f=f===c?!0:f,Canteen.settings.siteIndex!=a&&(g+=a),n==a?void(e&&this.refresh(f)):void(o?d?History.replaceState({state:m},h,g):(m++,History.pushState({state:m},h,g)):document.location.href=g)},j.refresh=function(a,b){a=a===c?!0:a,a&&o?this._updatePageContent(n,b):document.location.reload(!0)},j._fixInternalLinks=function(){b("a.internal, .confirm").untouch(),b(".confirm").confirmation(),b("a.internal").internalLink(this),g.setup(this,"true"===this.parameters.debugForms)},j._onStateChange=function(){var a=History.getState(),b=a.url.split(Canteen.settings.baseUrl)[1];n!=b&&this._updatePageContent(b)},j._gatewayReady=function(a){a||Debug.error("Unable to setup gateway.");var c=this.options;b(c.siteLoadingId).removeClass(c.loadingClass),b(window).on("resize",this.resize.bind(this)),this.resize(),this.trigger(i.READY),this._enterPage()},j.resize=function(){q&&q.active&&q.resize()},j.addPage=function(a,b){b instanceof h?(b.site=this,p.push({uri:a,content:b})):Debug.warn("The page your trying to add needs to extend Canteen.Page")},j._enterPage=function(){var a=this.getPageByUri(n);a&&(this.currentPage=q=a.content,q.uri=n,q.active=!0,q.enter(),this.resize()),this.trigger(i.ENTER,n)},j.getPageByUri=function(a){var b=p.length,c=0,d=null;if(0===b)return null;for(c=0;b>c;c++)if(d=p[c],d.uri===a||d.uri instanceof RegExp&&d.uri.test(a))return d;return null},j._updatePageContent=function(a,d){var e=this,f=this.options,h=this.getPageByUri(a),j=Canteen.settings.baseUrl+a;return this.trigger(i.EXIT,n),this.currentState=n=a,h&&h.content===q&&!h.content.refresh(a)?void(h.content.uri=a):(q&&(q.exit(),q.active=!1,this.currentPage=q=null),g.destroy(),l=a,d=d===c?{}:d,d.async=!0,this.trigger(i.LOADING),b(f.pageLoadingId).removeClass(f.loadingClass).addClass(f.loadingClass),void b.post(j,d,function(d){if(a==l){if(l=null,e.trigger(i.LOADING_DONE),b(f.pageLoadingId).removeClass(f.loadingClass),!d||"null"==d)return void Debug.error("No data for "+a);if(-1==d.search(/^{.*}$/))return void Debug.error(d);var g=JSON.parse(d);if("fatalError"==g.type)return void Debug.fatalError(g);if(g.redirect!==c)return void e.redirect(g.redirect,!0);b("body").attr("id",g.pageId),b(f.pageTitleId).html(g.title),b(f.contentId).html(g.content),document.title=b("<div />").html(g.fullTitle).text(),b("meta[name='keywords']").attr("content",g.keywords),b("meta[name='description']").attr("content",g.description),e._fixInternalLinks(),e._enterPage()}}))},namespace("Canteen").Site=i,b(function(){new i})}(window,jQuery);